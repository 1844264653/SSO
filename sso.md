## 这次聊聊单点登录机制

### 一、 单系统登录机制

##### 	1.http无状态协议

​			web应用采用BS架构，http作为通信协议。http是无状态协议，浏览器的每一次请求，服务器会独立处理，不与之前或者之后的请求产生关系，多次请求响应之间无任何关系。

​			

​			**但是这也就意味着，任何用户都能通过浏览器访问服务器资源，如果想保护服务器的某些资源，必须限制浏览器请求；要限制浏览器请求，必须鉴别浏览器请求，响应合法请求，忽略违法请求，要鉴别浏览器请求，必须清楚浏览器请求状态，既然http协议无状态，那就让服务器和浏览器共同维护一个状态吧!!!**，这就是会话机制。

##### 	2.会话机制session

​			浏览器第一次请求服务器，服务器会创建一个会话session，并将会话的id作为响应的一部分发送给浏览器，浏览器会存储会话id，服务器取得请求中的会话id就知道是不是同一个用户了

​			服务器在内存中保存会话对象，浏览器会怎么保存会话id呢？**1.请求参数   2. cookie**



​			讲会话id作为每一个请求的参数，服务器接收请求自然能解析参数会的会话id，并借此判断是否来自同一个会话，很明显，这种方式不靠谱。那浏览器就自己来维护这个会话id吧，每次发送http请求时浏览器自动发送会话id，cookie机制正好用来做这件事。cookie**时浏览器用来存储少量数据的一种机制，数据以key/value形式存储，浏览器发送http请求自动附带cookie信息**



​		**tomcat会话机制当然也实现了cookie，访问tomcat服务器时，浏览器中可以看到一个名为JSESSIONID的cookie，这就是tomcat的会话机制维护的会话id**

 

##### 	3.登录状态

​			有了会话机制，登录状态就好明白了，我们假设浏览器第一次请求服务器需要输入username和password验证身份，服务器拿到username和password去数据库对比，正确的话说明当前持有这个会话的用户是合法用户，应该将这个会话标记为**“已授权或者已登录”**等等之类的状态，既然是会话的状态，自然要保存在会话对象中，tomcat在会话对象中设置登录状态如下：

~~~tomcat
HttpSession session = request.getSession();
session。setAttribute("isLogin");
~~~

​			**每次请求受保护的资源时都会检查会话对象中的登录状态，之亚欧isLogin=true的会话才能访问，登录机制因此而实现**





### 二、多系统的复杂性